<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão da Deh!</title>
    <link rel="stylesheet" href="style.css">
    <!-- Ícones do Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Adicionando o manifest para PWA -->
    <link rel="manifest" href="manifest.json">
    <!-- FullCalendar (para a Agenda) -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <!-- Chart.js (para Gráficos) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- TELA DE LOGIN -->
    <div id="login-container" class="active">
        <div class="login-box">
            <h1 class="logo-login">Gestão de Consultas</h1>
            <form id="login-form">
                <div class="input-group"><label for="email">E-mail</label><input type="email" id="email" required></div>
                <div class="input-group"><label for="password">Senha</label><input type="password" id="password" required></div>
                <button type="submit" class="btn-primary">Entrar</button>
            </form>
        </div>
    </div>

    <!-- ESTRUTURA PRINCIPAL DA APLICAÇÃO -->
    <div id="app-container">
        <!-- MENU LATERAL -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2 class="logo-app">Gestão da Deh!</h2>
            </div>
            <ul class="nav-links">
                <li>
                    <a href="#" class="nav-link active" data-target="dashboard">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-target="pacientes">
                        <i class="fas fa-users"></i>
                        <span>Pacientes</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-target="agenda">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Agenda</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-target="horarios">
                        <i class="fas fa-clock"></i>
                        <span>Meus Horários</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-target="financeiro">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Financeiro</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-target="despesas">
                        <i class="fas fa-receipt"></i>
                        <span>Despesas</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-target="solicitacoes-nf">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Solicitações NF</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sair</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="main-content">
            <!-- Dashboard -->
            <section id="dashboard" class="content-section active">
                <h1>Dashboard</h1>
                <div class="chart-container">
                    <canvas id="dashboard-chart"></canvas>
                </div>
            </section>

            <!-- Pacientes -->
            <section id="pacientes" class="content-section">
                <div class="section-header"><h1>Cadastro de Pacientes</h1>
                    <button id="btn-novo-paciente" class="btn-primary"><i class="fas fa-plus"></i> Novo Paciente</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>Email</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-pacientes-body"></tbody>
                    </table>
                </div>
            </section>
            
            <!-- Agenda -->
            <section id="agenda" class="content-section">
                <div class="section-header">
                    <h1>Agenda de Consultas</h1>
                    <button id="btn-novo-agendamento" class="btn-primary"><i class="fas fa-plus"></i> Novo Agendamento</button>
                </div>
                <div id="calendar"></div>
            </section>

            <!-- Horários de Trabalho -->
            <section id="horarios" class="content-section">
                <div class="section-header">
                    <h1>Meus Horários de Trabalho</h1>
                    <button id="btn-novo-horario" class="btn-primary"><i class="fas fa-plus"></i> Novo Horário</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Dia da Semana</th>
                                <th>Início</th>
                                <th>Fim</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-horarios-body"></tbody>
                    </table>
                </div>
            </section>

            <!-- Financeiro (ATUALIZADO) -->
            <section id="financeiro" class="content-section">
                <h1>Financeiro - A Receber</h1>
                
                <div class="financeiro-section">
                    <h2>Vencidos</h2>
                    <div id="financeiro-vencidos-container" class="cards-container">
                        <!-- Cards de pacientes com dívidas vencidas serão inseridos aqui -->
                    </div>
                </div>

                <div class="financeiro-section">
                    <h2>A Vencer</h2>
                    <div id="financeiro-a-vencer-container" class="cards-container">
                        <!-- Cards de agendamentos futuros serão inseridos aqui -->
                    </div>
                </div>
            </section>

            <!-- Despesas (ATUALIZADO) -->
            <section id="despesas" class="content-section"> 
                <div class="section-header">
                    <h1>Lançamento de Despesas</h1>
                    <div>
                        <button id="btn-toggle-despesa-view" class="btn-primary"><i class="fas fa-calendar-alt"></i> Ver Calendário</button>
                        <button id="btn-nova-despesa" class="btn-primary"><i class="fas fa-plus"></i> Nova Despesa</button>
                    </div>
                </div>
                <!-- View de Tabela (padrão) -->
                <div id="despesas-table-view" class="view-container active">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descrição</th>
                                    <th>Categoria</th>
                                    <th>Valor</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-despesas-body"></tbody>
                        </table>
                    </div>
                </div>
                <!-- View de Calendário (escondida) -->
                <div id="despesas-calendar-view" class="view-container">
                    <div id="despesas-calendar"></div>
                </div>
            </section>

            <!-- Solicitações NF -->
            <section id="solicitacoes-nf" class="content-section">
                <div class="section-header">
                    <h1>Solicitações de Nota Fiscal</h1>
                    <button id="btn-nova-solicitacao-nf" class="btn-primary"><i class="fas fa-plus"></i> Nova Solicitação</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Paciente</th>
                                <th>Valor Total</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-solicitacoes-nf-body"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- MODAIS -->
    <!-- Modal Paciente -->
    <div id="paciente-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="paciente-modal-title">Novo Paciente</h2>
            <form id="paciente-form">
                <input type="hidden" id="paciente-id">
                <div class="form-grid">
                    <div class="input-group">
                        <label for="nome">Nome Completo*</label>
                        <input type="text" id="nome" required>
                    </div>
                    <div class="input-group">
                        <label for="data-nascimento">Data de Nascimento</label>
                        <input type="date" id="data-nascimento">
                    </div>
                    <div class="input-group">
                        <label for="cpf">CPF</label>
                        <input type="text" id="cpf">
                    </div>
                    <div class="input-group">
                        <label for="telefone">Telefone</label>
                        <input type="tel" id="telefone">
                    </div>
                    <div class="input-group">
                        <label for="email-paciente">E-mail</label>
                        <input type="email" id="email-paciente">
                    </div>
                    <div class="input-group full-width">
                        <label for="endereco">Endereço</label>
                        <input type="text" id="endereco">
                    </div>
                    <hr class="full-width">
                    <h3 class="full-width">Responsável (se menor de idade)</h3>
                    <div class="input-group">
                        <label for="nome-responsavel">Nome do Responsável</label>
                        <input type="text" id="nome-responsavel">
                    </div>
                    <div class="input-group">
                        <label for="cpf-responsavel">CPF do Responsável</label>
                        <input type="text" id="cpf-responsavel">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-danger close-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- MODAL DESPESA (ATUALIZADO) -->
    <div id="despesa-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="despesa-modal-title">Nova Despesa</h2>
            <form id="despesa-form">
                <input type="hidden" id="despesa-id">
                <div class="form-grid">
                    <div class="input-group full-width"><label for="despesa-descricao">Descrição*</label><input type="text" id="despesa-descricao" required></div>
                    <div class="input-group"><label for="despesa-valor">Valor (R$)*</label><input type="number" step="0.01" id="despesa-valor" required></div>
                    <div class="input-group"><label for="despesa-data">Data da Despesa*</label><input type="date" id="despesa-data" required></div>
                    
                    <div class="input-group">
                        <label for="despesa-status">Status*</label>
                        <select id="despesa-status" required>
                            <option value="Aguardando">Aguardando</option>
                            <option value="Pago">Pago</option>
                        </select>
                    </div>

                    <div class="input-group"><label for="despesa-categoria">Categoria</label><input type="text" id="despesa-categoria"></div>
                    
                    <!-- Input de ficheiro agora aceita múltiplos -->
                    <div class="input-group full-width"><label for="despesa-anexo">Anexar Comprovantes</label><input type="file" id="despesa-anexo" multiple></div>

                    <!-- Lista para mostrar os anexos existentes -->
                    <div class="input-group full-width" id="despesa-anexos-list-container" style="display: none;">
                        <label>Anexos Salvos</label>
                        <ul id="despesa-anexos-list"></ul>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary close-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Agendamento -->
    <div id="agendamento-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="agendamento-modal-title">Novo Agendamento</h2>
            <form id="agendamento-form">
                <input type="hidden" id="agendamento-id">
                <div class="form-grid">
                    <div class="input-group full-width">
                        <label for="agendamento-paciente">Paciente*</label>
                        <select id="agendamento-paciente" required>
                     </select>
                    </div>
                    <div class="input-group">
                        <label for="agendamento-data">Data*</label>
                        <input type="date" id="agendamento-data" required>
                    </div>
                    <div class="input-group">
                        <label for="agendamento-hora">Hora*</label>
                        <input type="time" id="agendamento-hora" required>
                    </div>
                    <div class="input-group">
                        <label for="agendamento-valor">Valor (R$)*</label>
                        <input type="number" step="0.01" id="agendamento-valor" required>
                    </div>
                    <div class="input-group">
                        <label for="agendamento-status">Status*</label>
                        <select id="agendamento-status" required>
                            <option value="Em_Aberto">Em Aberto</option>
                            <option value="Pago">Pago</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="input-group full-width">
                        <label for="agendamento-obs">Observações</label>
                        <textarea id="agendamento-obs" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-danger" id="btn-deletar-agendamento" style="display:none; margin-right: auto;">Excluir</button>
                    <button type="button" class="btn-danger close-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal Horário de Trabalho -->
    <div id="horario-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="horario-modal-title">Novo Horário</h2>
            <form id="horario-form">
                <input type="hidden" id="horario-id">
                <div class="form-grid">
                    <div class="input-group">
                        <label for="horario-dia">Dia da Semana*</label>
                        <select id="horario-dia" required>
                            <option value="Segunda">Segunda-feira</option>
                            <option value="Terca">Terça-feira</option>
                            <option value="Quarta">Quarta-feira</option>
                            <option value="Quinta">Quinta-feira</option>
                            <option value="Sexta">Sexta-feira</option>
                            <option value="Sabado">Sábado</option>
                            <option value="Domingo">Domingo</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="horario-inicio">Hora de Início*</label>
                        <input type="time" id="horario-inicio" required>
                    </div>
                    <div class="input-group">
                        <label for="horario-fim">Hora de Fim*</label>
                        <input type="time" id="horario-fim" required>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-danger close-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- MODAL SOLICITAÇÃO NF (NOVO) -->
    <div id="solicitacao-nf-modal" class="modal">
        <div class="modal-content large">
            <span class="close-btn">&times;</span>
            <h2 id="solicitacao-nf-modal-title">Nova Solicitação de NF</h2>
            <form id="solicitacao-nf-form">
                <input type="hidden" id="solicitacao-nf-id">
                
                <div class="form-grid">
                    <div class="input-group full-width">
                        <label for="solicitacao-paciente">1. Selecione o Paciente*</label>
                        <select id="solicitacao-paciente" required></select>
                    </div>

                    <div id="solicitacao-dados-container" style="display: none;" class="full-width form-grid">
                        <hr class="full-width">
                        <h3 class="full-width">2. Confirme os Dados para a NF (editável)</h3>
                        <div class="input-group"><label for="solicitacao-nome-nf">Nome Completo*</label><input type="text" id="solicitacao-nome-nf" required></div>
                        <div class="input-group"><label for="solicitacao-cpf-nf">CPF</label><input type="text" id="solicitacao-cpf-nf"></div>
                        <div class="input-group full-width"><label for="solicitacao-endereco-nf">Endereço</label><input type="text" id="solicitacao-endereco-nf"></div>
                        
                        <hr class="full-width">
                        <h3 class="full-width">3. Selecione os Agendamentos Pagos</h3>
                        <div id="solicitacao-agendamentos-list" class="full-width checklist-container">
                            <!-- Agendamentos disponíveis serão inseridos aqui -->
                        </div>
                        <p class="full-width"><strong>Valor Total Selecionado: <span id="solicitacao-valor-total">R$ 0,00</span></strong></p>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary close-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Solicitar NF</button>
                </div>
            </form>
        </div>
    </div>


    <script src="script.js"></script>
</body>
</html>
